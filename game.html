<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <style>
    canvas{
      position: absolute;
      top: 0px;
      bottom: 0px;
      left: 0px;
      right: 0px;
      margin: auto;
    }
  </style>

  <title>Engine</title>
</head>
<body>
  <script>

    //VariÃ¡veis
    let canvas, contexto, ALTURA, LARGURA, frames = 0;
    let maxPulos = 3;

    let chao = {
      y: 550,
      altura: 50,
      cor: '#ffdf70',

      desenha: function(){
        contexto.fillStyle = this.cor;
        contexto.fillRect(0, this.y, LARGURA, this.altura);
      }
    };

    let bloco = {
      x: 50,
      y: 0,
      altura: 50,
      largura: 50,
      cor: '#ff4e4e',
      gravidade: 1.6,
      velocidade: 0,
      force: 20,
      qntPulos: 0,

      atualizar: function(){
        this.velocidade += this.gravidade;
        this.y += this.velocidade;

        if(this.y > chao.y - this.altura){
          this.y = chao.y - this.altura;          
          this.qntPulos = 0;
        }
      },

      pula: function(){
        if(this.qntPulos < maxPulos){
          this.velocidade = -this.force;
          this.qntPulos++;
        }
      },

      desenha: function(){
        contexto.fillStyle = this.cor;
        contexto.fillRect(this.x, this.y, this.largura, this.altura);
      }
    };

    let obstaculos = {
      obs: [],
      cor: '#52a700',

      insere: function(){
        this.obs.push({
          x: LARGURA,
          largura: 30 + Math.floor(21 * Math.random()),
          altura: 30 + Math.floor(121 * Math.random()),
          cor: this.cor,
        });
      },

      atualiza: function(){

      },

      desenha: function(){
        for(let i = 0, tamanho = this.obs.length; i < tamanho; i++){
          let obsi = this.obs[i];
          contexto.fillStyle = obsi.cor;
          contexto.fillRect(obsi.x, chao.y - obsi.altura, obsi.largura, obsi.altura);
        }
      }
    };

    function clique(event) {
      bloco.pula();
    }

    function principal() {
      ALTURA = window.innerHeight;
      LARGURA = window.innerWidth;

      if(LARGURA >= 500){
        LARGURA = 600;
        ALTURA = 600;
      }

      //Cria o canvas
      canvas = document.createElement("canvas");
      canvas.width = LARGURA;
      canvas.height = ALTURA;
      canvas.style.border = "1px solid #000000";

      contexto = canvas.getContext("2d");
      document.body.appendChild(canvas);
      document.addEventListener("mousedown", clique);

      rodar();
    }

    function rodar() {
      atualizar();
      desenhar();

      window.requestAnimationFrame(rodar);
    }

    function atualizar() {
      frames++;

      //Atualizar o bloco
      bloco.atualizar();
    }

    function desenhar() {
      contexto.fillStyle = "#50beff";
      contexto.fillRect(0, 0, LARGURA, ALTURA);

      chao.desenha();
      obstaculos.desenha();
      bloco.desenha();
    }

    //Inicia o game
    principal();
  </script>
  
</body>
</html>